<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Mischief Managed</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Cormorant+Garamond:ital,wght@0,600;0,700;1,600&family=Mr+De+Haviland&display=swap" rel="stylesheet">

<style>
    :root {
        --paper: #F2E8C9; /* Warm Parchment */
        --ink: #2A1B0E;    /* Deep Sepia Ink */
        --ink-light: #5C4033;
        --burgundy: #740001;
        --gold: #D4AF37;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

    body {
        margin: 0; padding: 0;
        background-color: var(--paper);
        color: var(--ink);
        font-family: 'Cormorant Garamond', serif;
        height: 100dvh; width: 100vw;
        overflow: hidden;
        position: fixed;
    }

    /* --- BACKGROUND TEXTURE --- */
    #paper-texture {
        position: fixed; inset: 0;
        background-image: url("https://www.transparenttextures.com/patterns/aged-paper.png");
        opacity: 0.8; z-index: -1;
    }
    
    #map-overlay {
        position: fixed; inset: 0; z-index: -1; opacity: 0.1;
        background: repeating-linear-gradient(45deg, #2A1B0E 0, #2A1B0E 1px, transparent 0, transparent 50%);
        background-size: 20px 20px;
        mask-image: radial-gradient(circle, transparent 30%, black 100%);
    }

    /* --- LAYOUT --- */
    .screen {
        position: absolute; inset: 0;
        display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        padding: 24px;
        opacity: 0; visibility: hidden;
        z-index: 10;
        transition: opacity 0.6s ease;
    }
    .screen.active { opacity: 1; visibility: visible; }

    /* --- TYPOGRAPHY (Handwritten & Bold) --- */
    h1 {
        font-family: 'Cinzel', serif;
        font-size: 2.2rem;
        color: var(--ink);
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 10px;
        border-bottom: 2px solid var(--ink);
        padding-bottom: 10px;
    }

    .handwritten {
        font-family: 'Mr De Haviland', cursive;
        font-size: 3.5rem;
        color: var(--burgundy);
        line-height: 0.8;
        transform: rotate(-5deg);
        margin: 10px 0;
    }

    p {
        font-size: 1.4rem;
        font-weight: 600;
        text-align: center;
        color: var(--ink-light);
        margin-bottom: 30px;
        line-height: 1.4;
    }

    /* --- COMPONENT: THE INK CARD --- */
    .ink-card {
        width: 100%; max-width: 450px;
        background: rgba(242, 232, 201, 0.9);
        border: 2px solid var(--ink);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 10px 10px 0px rgba(42, 27, 14, 0.1); /* Ink Shadow */
        position: relative;
    }

    /* Corners */
    .ink-card::before {
        content: ''; position: absolute; inset: 4px;
        border: 1px solid var(--ink);
        pointer-events: none;
    }

    /* --- COMPONENT: OPTIONS (INK STAMPS) --- */
    .options-stack { display: flex; flex-direction: column; gap: 15px; width: 100%; }

    .ink-btn {
        width: 100%;
        background: transparent;
        border: 2px solid var(--ink);
        padding: 18px;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer;
        transition: 0.2s;
        position: relative;
        overflow: hidden;
    }

    .btn-text {
        font-size: 1.3rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--ink);
        z-index: 2;
    }

    /* Selection Effect: Ink Blot */
    .ink-btn::after {
        content: ''; position: absolute; inset: 0;
        background: var(--ink);
        transform: scaleX(0); transform-origin: left;
        transition: transform 0.3s cubic-bezier(0.7, 0, 0.3, 1);
        z-index: 1;
    }

    .ink-btn.active::after { transform: scaleX(1); }
    .ink-btn.active .btn-text { color: var(--paper); }

    /* --- FOOTSTEPS ANIMATION --- */
    .footstep {
        position: fixed;
        font-size: 24px;
        color: var(--ink);
        opacity: 0;
        pointer-events: none;
        z-index: 5;
    }

    /* --- FORM --- */
    .form-line {
        width: 100%;
        border: none;
        background: transparent;
        border-bottom: 2px solid var(--ink);
        padding: 12px 0;
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.5rem;
        color: var(--ink);
        font-weight: 700;
        margin-bottom: 20px;
    }
    .form-line::placeholder { color: rgba(42, 27, 14, 0.4); font-style: italic; }
    .form-line:focus { border-bottom-color: var(--burgundy); }

    .confirm-btn {
        background: var(--burgundy);
        color: var(--paper);
        font-family: 'Cinzel', serif;
        font-size: 1.2rem;
        padding: 18px;
        width: 100%;
        border: none;
        margin-top: 10px;
        box-shadow: 5px 5px 0 rgba(0,0,0,0.2);
    }

    /* --- UTILS --- */
    .progress-ink {
        position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
        font-family: 'Cinzel'; font-size: 0.9rem; color: var(--ink-light);
        opacity: 0.6;
    }

</style>
</head>
<body>

    <div id="paper-texture"></div>
    <div id="map-overlay"></div>

    <div id="screen-intro" class="screen active">
        <h1 style="border:none; font-size: 1.5rem;">The Archive</h1>
        <div class="ink-card" style="text-align: center; padding: 40px;" onclick="startApp()">
            <p style="font-size: 1.6rem; color: var(--ink); margin: 0;">Tap to Reveal</p>
            <div class="handwritten" style="font-size: 4rem; margin-top: 20px;">I solemnly swear...</div>
        </div>
    </div>

    <div id="screen-quiz" class="screen">
        <h2 id="q-counter" class="progress-ink">PAGE 1 / 12</h2>
        <div class="ink-card">
            <h1 id="q-text" style="border:none; font-size: 1.6rem; margin-bottom: 30px;">Question</h1>
            <div class="options-stack" id="options-container"></div>
        </div>
    </div>

    <div id="screen-bridge" class="screen">
        <div class="handwritten" id="bridge-text" style="font-size: 6rem; opacity: 0;">Magic</div>
    </div>

    <div id="screen-reveal" class="screen">
        <div class="ink-card" style="text-align: center;">
            <p style="text-transform: uppercase; font-size: 0.9rem; letter-spacing: 2px;">Identity Verified</p>
            <h1 style="font-size: 2.5rem; border-bottom: 2px double var(--ink); padding-bottom: 15px;">Hermione Granger</h1>
            <p style="margin-top: 20px;">It wasn't just the books. It was the loyalty. You stayed when everyone else left.</p>
            <div class="handwritten" style="font-size: 3rem;">That is why.</div>
            <button class="confirm-btn" onclick="goToForm()">Open Registry</button>
        </div>
    </div>

    <div id="screen-form" class="screen">
        <div class="ink-card">
            <h1 style="font-size: 1.8rem; margin-bottom: 20px;">Owl Post Registry</h1>
            
            <input type="text" id="name" class="form-line" placeholder="Witch's Name">
            <input type="tel" id="mobile" class="form-line" placeholder="Mobile Number">
            <div style="display: flex; gap: 15px;">
                <input type="number" id="pin" class="form-line" placeholder="PIN">
                <input type="text" id="city" class="form-line" placeholder="City">
            </div>
            <input type="text" id="address" class="form-line" placeholder="Full Address">

            <button class="confirm-btn" id="submit-btn" onclick="submitForm()">Mischief Managed</button>
            <p id="loading" style="display: none; text-align: center; margin-top: 15px;">Owl taking flight...</p>
        </div>
    </div>

    <div id="screen-end" class="screen">
        <div class="handwritten" style="font-size: 5rem;">Always.</div>
        <p>The Owl is on its way.</p>
    </div>

    <div id="footsteps-layer"></div>

    <script>
        // *** CONFIGURATION: ADD KEYS HERE ***
        const EMAIL_KEY = 'YOUR_PUBLIC_KEY'; 
        const SERVICE_ID = 'YOUR_SERVICE_ID';
        const TEMPLATE_ID = 'YOUR_TEMPLATE_ID';

        (function(){ emailjs.init(EMAIL_KEY); })();

        // --- QUESTIONS ---
        const questions = [
            { q: "The Hat sits on your head. Where do you belong?", o: ["Gryffindor", "Ravenclaw", "Slytherin", "Hufflepuff"] },
            { q: "What do you see in the Mirror of Erised?", o: ["Glory", "Peace", "Love", "Knowledge"] },
            { q: "The Boggart appears. What is it?", o: ["Failure", "Isolation", "Darkness", "Loss"] },
            { q: "Who do you hope asks you to the Ball?", o: ["Harry", "Ron", "Draco", "No one"] },
            { q: "Which death hurt the most?", o: ["Dobby", "Sirius", "Fred", "Snape"] },
            { q: "Choose one Hallow.", o: ["Elder Wand", "Stone", "Cloak", "None"] },
            { q: "Why did you stay when Ron left?", o: ["Duty", "Hope", "Loyalty", "Love"] },
            { q: "Did you forgive Snape?", o: ["Yes", "No", "Complicated", "Always"] },
            { q: "How did the ending feel?", o: ["Perfect", "Sad", "Hopeful", "Empty"] },
            { q: "Who was the bravest?", o: ["Harry", "Hermione", "Neville", "Snape"] },
            { q: "One word for the journey?", o: ["Magic", "Home", "Childhood", "Forever"] },
            { q: "Why do I call you my Hermione?", o: ["My Brains", "My Loyalty", "My Heart", "My Magic"] }
        ];

        let qIdx = 0;
        let answers = {};

        // --- LOGIC ---
        function startApp() {
            gsap.to('#screen-intro', { opacity: 0, scale: 1.1, duration: 0.5, onComplete: () => {
                document.getElementById('screen-intro').classList.remove('active');
                document.getElementById('screen-quiz').classList.add('active');
                gsap.fromTo('#screen-quiz', { opacity: 0 }, { opacity: 1, duration: 0.5 });
                loadQuestion();
            }});
        }

        function loadQuestion() {
            const data = questions[qIdx];
            const container = document.getElementById('options-container');
            const qText = document.getElementById('q-text');
            
            document.getElementById('q-counter').innerText = `PAGE ${qIdx + 1} / ${questions.length}`;

            // Fade Out
            gsap.to([qText, container], { opacity: 0, y: -10, duration: 0.2, onComplete: () => {
                qText.innerText = data.q;
                container.innerHTML = '';

                data.o.forEach(opt => {
                    const btn = document.createElement('div');
                    btn.className = 'ink-btn';
                    btn.innerHTML = `<span class="btn-text">${opt}</span>`;
                    btn.onclick = (e) => selectOption(e, btn, opt);
                    container.appendChild(btn);
                });

                // Fade In
                gsap.to([qText, container], { opacity: 1, y: 0, duration: 0.3 });
                gsap.from('.ink-btn', { x: -20, opacity: 0, stagger: 0.05 });
            }});
        }

        function selectOption(e, btn, val) {
            btn.classList.add('active');
            answers[`Q${qIdx+1}`] = val;
            
            // FOOTSTEPS EFFECT
            createFootsteps();

            setTimeout(() => {
                qIdx++;
                if(qIdx < questions.length) {
                    loadQuestion();
                } else {
                    showBridge();
                }
            }, 600);
        }

        function createFootsteps() {
            const layer = document.getElementById('footsteps-layer');
            const steps = ['ðŸ‘£', 'ðŸ‘£', 'ðŸ‘£'];
            
            steps.forEach((step, i) => {
                const el = document.createElement('div');
                el.className = 'footstep';
                el.innerText = step;
                // Random position near center
                el.style.left = (window.innerWidth/2 - 50 + (i*30)) + 'px';
                el.style.top = (window.innerHeight/2 + (i*40)) + 'px';
                layer.appendChild(el);

                gsap.to(el, { opacity: 1, duration: 0.5, delay: i*0.2, onComplete: () => {
                    gsap.to(el, { opacity: 0, duration: 0.5, delay: 0.2, onComplete: () => el.remove() });
                }});
            });
        }

        function showBridge() {
            transition('screen-quiz', 'screen-bridge');
            gsap.fromTo('#bridge-text', { opacity: 0, scale: 0.5 }, { opacity: 1, scale: 1.2, duration: 2, onComplete: () => {
                transition('screen-bridge', 'screen-reveal');
            }});
        }

        function goToForm() { transition('screen-reveal', 'screen-form'); }

        function transition(fromID, toID) {
            const from = document.getElementById(fromID);
            const to = document.getElementById(toID);
            gsap.to(from, { opacity: 0, duration: 0.5, onComplete: () => {
                from.classList.remove('active');
                to.classList.add('active');
                gsap.fromTo(to, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 });
            }});
        }

        function submitForm() {
            const data = {
                ...answers,
                name: document.getElementById('name').value,
                mobile: document.getElementById('mobile').value,
                pin: document.getElementById('pin').value,
                city: document.getElementById('city').value,
                address: document.getElementById('address').value
            };

            if(!data.name || !data.address) {
                gsap.to('.ink-card', { x: 10, duration: 0.1, yoyo: true, repeat: 5 });
                return;
            }

            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            emailjs.send(SERVICE_ID, TEMPLATE_ID, data)
                .then(() => transition('screen-form', 'screen-end'))
                .catch(() => alert('Error. Please screenshot.'));
        }
    </script>
</body>
</html>
